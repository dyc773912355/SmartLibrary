<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smartlibrary.dao.readerReportDao">
    <!-- 1. 读者姓名、学院、身份-->
    <select id="getReaderInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select `name`,academy,identity
        from reader_report
        where account=#{account}
    </select>
    <!-- 读者第一次进馆时间、累计进馆次数、到馆次数超过校友百分比（例如：超过87%的校友）-->
    <select id="getReaderGctrlInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select first_gctr_date,all_gctrl_times,(1-all_gctrl_rank/(select max(all_gctrl_rank) from reader_report)) as per_gctrl_times
        from reader_report
        where account=#{account}
    </select>

    <!-- 读者借阅时间最长的书名及借阅天数、借书总量、借书量排名（如: 排名第87位）-->
    <select id="getReaderBookLendInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select longgest_book_name,longgest_book_days,all_lend_times,all_lend_rank
        from reader_report
        where account=#{account}
    </select>


    <!-- 借书最多的书籍类别及借阅该类别书籍的总量（如：文学类，共借阅212本），借阅图书最多的月份及该月借阅数量，借阅各类别图书所占百分比（如：经济42%，外语7%…）-->
    <select id="getReaderMaxBookLendInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select a.`year` ,a.account,a.A,a.B,a.C,a.D,a.E,a.F,a.G,b.H,b.I,b.J,b.K,b.N,b.O,b.P,b.H,c.Q,c.Q,c.R,c.S,c.T,c.U,c.V,c.X,c.Z,r.max_book_month,r.max_book_month_count
        from reader_report r,reader_report_type1 a,reader_report_type2 b ,reader_report_type3 c
        where r.account=a.account and a.account=b.account and a.account=c.account
        and  r.`max_book_year`= DATE_FORMAT('2015-05-05', '%Y')
        and  a.`year`= DATE_FORMAT('2015-05-05', '%Y')
        and  b.`year`= DATE_FORMAT('2015-05-05', '%Y')
        and  c.`year`= DATE_FORMAT('2015-05-05', '%Y')
        where account=#{account}
    </select>


    <!-- 打印页数最多文件的页数及日期、累计文印总量、文印总量排名百分比、文印各类别数量-->
    <select id="getReaderprintInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select account,max_print_date,max_print_counts,all_printcs_counts,all_printcs_rank,all_print_counts,all_copy_counts,all_scan_counts
        from reader_report
        where account=#{account}
    </select>

    <!-- 座位使用时间最长时长及日期（如：2015年9月16日使用座位4小时）、座位使用总次数、研修间使用总时长、每年座位及研修间使用总时长
            新表-学号-学年-座位总时长-研修间总时长-电子阅览室总时长-借阅次数-->
    <select id="getReaderDeviceHourInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select  ic.`year` ,r.account, r.all_seat_hours, r.all_croom_hours, r.all_eread_hours,ic.lend
        from reader_report r,reader_report_ic_lend ic
        where r.account=ic.account and
         account=#{account}
    </select>


    <!-- 电子阅览室使用时间最长时长及日期、电子阅览室使用总次数、使用总时长-->
    <select id="getReaderEreadHourInfo" parameterType="com.smartlibrary.domain.reader_report" resultType="com.smartlibrary.domain.reader_report">
        select r.account,r.longgest_eread_date,r.longgest_eread_hours,r.all_eread_times,r.all_eread_hours
        from reader_report r
        where account=#{account}
    </select>


</mapper>